# Demagnetizing field from an uniform magnetization

Also known as the **stray field** (outside the magnet), the demagnetizing field is the magnetic field (H-field) generated by a given magnetization (M-field) inside a magnet. See the [demagnetizing field](https://en.wikipedia.org/wiki/Demagnetizing_field) page for more information.

Everywhere the magnetic induction is $\bm{B}=\mu_0({\bm{H}+\bm{M}})$, so from the Maxwell equations,
$${\bm\nabla}\cdot\bm{H}=-{\bm\nabla}\cdot\bm{M}$$
One can find a potential $\phi$ such as ${\bm H}=-{\bm\nabla}\phi$ and the [weak formulation](https://en.wikipedia.org/wiki/Weak_formulation) becomes (Integration par parts and zero-condition on the boundary):
$$\int_V{\bm\nabla}\phi\cdot{\bm\nabla}v\quad\!\!\!\! d{\bm x}=\int_V{\bm M}\cdot{\bm\nabla}v\quad\!\!\!\! d{\bm x}$$
Each example considers the application of an uniform magnetization inside the magnet, which is zero outside.

* For the 2D <span style="color:blue">**sphere**</span> (disk_sphere.geo), the stray field inside the magnet is also uniform with ${\bm H}=-\frac{{\bm M}}{2}$. Please verify that the value of hnorm.pos inside the magnet is around 0.5 numerically.

* For the 2D <span style="color:blue">**ellipsoid**</span> (disk_ellipsoid.geo), the stray field inside is uniform with ${\bm H}=-\overline{\overline{N}} {\bm M}$. The demagnetizing tensor $\overline{\overline{N}}$ is diagonal with two eigenvalues $N_x$ and $N_y$ such as $N_x+N_y=1$. Their values depend on the ratio of the length of the ellipsoid axes.

* For a 2D <span style="color:blue">**square**</span> (disk_square.geo), the stray field inside the magnet is not uniform.

In order to run each specific example (assuming [gmsh](https://gmsh.info/) is installed):
```bash
ln -s disk_example.geo disk.geo
gmsh -o disk.msh -format msh22 -2 disk.geo
```
